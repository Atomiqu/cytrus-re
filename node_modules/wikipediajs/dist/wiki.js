"use strict";

var _require = require("./constants/index"),
    FEATURED = _require.FEATURED;

var _require2 = require("./generators/index"),
    doSearch = _require2.doSearch,
    doRandom = _require2.doRandom,
    doAllCatergories = _require2.doAllCatergories;

var _require3 = require("./utils/urlUtils"),
    queryApi = _require3.queryApi;

var convert = require("xml-js");

function search(searchTerm) {
  var lang = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "en";
  var options = arguments[2];

  return doSearch(searchTerm, lang, options);
}

function random() {
  var lang = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "en";
  var options = arguments[1];

  return doRandom(lang, options);
}

function featured() {
  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : { feed: "potd" };

  var params = Object.assign({}, options, {
    action: FEATURED
  });

  return queryApi("en", params).then(function (response) {
    if (response) {
      var json = convert.xml2js(response, { compact: false });
      if (json.elements && json.elements.length) {
        return json.elements[0];
      }
    }
  });
}

function allCategories() {
  var lang = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "en";
  var options = arguments[1];

  return doAllCatergories(lang, options);
}

module.exports = {
  search: search,
  random: random,
  featured: featured,
  allCategories: allCategories
};